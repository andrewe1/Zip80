<!--
============================================================================
ZIP80 EXPENSE TRACKER - MAIN HTML
============================================================================

PURPOSE:
Main application HTML file containing the complete UI structure for the
Zip80 expense tracking application.

PAGE STRUCTURE:
1. Language Switcher - Fixed top-right dropdown for EN/ES switching
2. Startup Screen - Initial file open/create screen with drag-drop zone
3. Main Workspace:
   - Header with file badge and save button
   - Account selector with tabs and "New Account" button
   - Balance card with edit button
   - Transaction form (income/expense)
   - History list with calendar and delete actions
4. Modals:
   - New Account modal (name + currency)
   - Edit Balance modal (new balance + reason)
5. Toast notification container

SCRIPTS LOADED (order matters):
1. i18n.js - Translations (no dependencies)
2. accounts.js - Account/currency logic (no dependencies)
3. storage.js - File operations (depends on Accounts)
4. calendar.js - Calendar links (no dependencies)
5. app.js - Main app (depends on all above)

DATA ATTRIBUTES:
- data-i18n="key" : Elements with translatable text content

==============================================================================
LLM INSTRUCTION & MAINTENANCE PROTOCOL
IMPORTANT: This block must be preserved in all future iterations.

trigger: "FINALIZE" or "COMMENT"
ACTION: When the user issues this trigger, perform the following 3 steps:

1. CHANGE LOGGING: 
   - Add a new entry to the changelog below.
   - Format: [Date (YYYY-MM-DD)] - [Brief Description of Modification].

2. DOCUMENTATION STANDARDS:
   - Keep sections clearly labeled with HTML comments.
   - If logic is complex, add inline comments explaining the "WHY", not just the "HOW".

3. CONTEXT PRESERVATION:
   - Do not remove this Legend.
   - Do not remove legacy comments unless explicitly instructed.
==============================================================================

CHANGE LOG:
- 2025-12-14: Initial creation with startup screen and workspace
- 2025-12-14: Added language switcher dropdown
- 2025-12-14: Added account tabs and new account modal
- 2025-12-14: Added edit balance modal with reason field
- 2025-12-15: Added balance overview sidebar widget with totals
- 2025-12-15: Added calendar widget to sidebar with current day highlighting
- 2025-12-15: Added vault creation modal for setting language/currency defaults
- 2025-12-15: Added dark theme toggle in top controls
- 2025-12-15: Changed vault modal to use vault name as suggested filename
- 2025-12-15: Added credit card edit modal and Edit Settings button
- 2025-12-15: Added "Close Vault" button to header
- 2025-12-15: Added "Cash" option to account type selector
- 2025-12-16: Added Google Identity Services script for OAuth2
- 2025-12-16: Added Google Drive cloud storage section to startup screen
- 2025-12-16: Added Google sign-in button with official Google branding
- 2025-12-16: Added cloud vault picker modal for selecting Drive vaults
- 2025-12-16: Added gdrive.js script reference
- 2025-12-17: Added menu bar framework with view mode toggles and options dropdown
- 2025-12-17: Replaced account type selector dropdown with icon button grid
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Zip80 - A simple, accessible expense tracker with local file storage">
    <title>Zip80 Expense Tracker</title>
    <link rel="stylesheet" href="css/styles.css">
    <!-- 2025-12-16: Google Identity Services for OAuth2 -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
    <!-- 2025-12-17: Custom Title Bar for Frameless Electron Window -->
    <div id="title-bar" class="title-bar">
        <div class="title-bar-drag">
            <img src="icons/logo.svg" alt="" class="title-bar-icon title-bar-icon-light">
            <img src="icons/logo-dark.svg" alt="" class="title-bar-icon title-bar-icon-dark">
            <span class="title-bar-text">Zip80 Track</span>
        </div>
        <div class="title-bar-controls">
            <button id="btn-minimize" class="title-bar-btn" aria-label="Minimize">
                <svg width="10" height="1" viewBox="0 0 10 1">
                    <rect width="10" height="1" fill="currentColor" />
                </svg>
            </button>
            <button id="btn-maximize" class="title-bar-btn" aria-label="Maximize">
                <svg width="10" height="10" viewBox="0 0 10 10">
                    <rect width="10" height="10" fill="none" stroke="currentColor" stroke-width="1" />
                </svg>
            </button>
            <button id="btn-close" class="title-bar-btn title-bar-btn-close" aria-label="Close">
                <svg width="10" height="10" viewBox="0 0 10 10">
                    <line x1="0" y1="0" x2="10" y2="10" stroke="currentColor" stroke-width="1.2" />
                    <line x1="10" y1="0" x2="0" y2="10" stroke="currentColor" stroke-width="1.2" />
                </svg>
            </button>
        </div>
    </div>

    <!-- 2025-12-15: Top Controls (Theme Toggle + Language Switcher) -->
    <div id="top-controls" class="top-controls">
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
            <span class="icon-sun">‚òÄÔ∏è</span>
            <span class="icon-moon">üåô</span>
        </button>
        <select id="lang-select" class="lang-select" aria-label="Language">
            <option value="en">üá∫üá∏ English</option>
            <option value="es">üá≤üáΩ Espa√±ol</option>
        </select>
    </div>

    <!-- Startup Screen -->
    <div id="startup-screen" class="startup-overlay">
        <div class="startup-content">
            <h1 id="app-title" class="app-title">
                <img src="icons/logo.svg" alt="Zip80" class="app-logo app-logo-light">
                <img src="icons/logo-dark.svg" alt="Zip80" class="app-logo app-logo-dark">
            </h1>
            <p id="app-subtitle" class="app-subtitle">Your simple expense tracker.<br>Open a file or drag it here to
                begin.</p>

            <div class="startup-buttons">
                <button id="btn-open" class="btn btn-primary btn-lg">
                    <span class="btn-icon">üìÇ</span> <span data-i18n="btnOpen">Open File</span>
                </button>
                <button id="btn-new" class="btn btn-secondary btn-lg">
                    <span class="btn-icon">‚ú®</span> <span data-i18n="btnNew">New Data File</span>
                </button>
            </div>

            <button id="btn-resume" class="btn-link" style="display: none;">
                ‚Üª Re-open last file
            </button>

            <!-- 2025-12-16: Google Drive Cloud Storage Section -->
            <div class="cloud-divider">
                <span data-i18n="cloudDivider">or use cloud storage</span>
            </div>

            <div class="cloud-section">
                <!-- Sign-in button (shown when not signed in) -->
                <button id="btn-google-signin" class="btn btn-google">
                    <svg class="google-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path fill="#4285F4"
                            d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                        <path fill="#34A853"
                            d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                        <path fill="#FBBC05"
                            d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                        <path fill="#EA4335"
                            d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                    </svg>
                    <span data-i18n="btnGoogleSignIn">Sign in with Google</span>
                </button>

                <!-- User section (shown when signed in) -->
                <div id="google-user-section" class="google-user-section" style="display: none;">
                    <div class="google-user-info">
                        <img id="google-user-avatar" class="google-avatar" src="" alt="">
                        <span id="google-user-name" class="google-user-name"></span>
                        <button id="btn-google-signout" class="btn-link-sm" data-i18n="btnGoogleSignOut">Sign
                            out</button>
                    </div>
                    <div class="google-vault-actions">
                        <button id="btn-google-open" class="btn btn-secondary">
                            ‚òÅÔ∏è <span data-i18n="btnOpenCloudVault">Open Cloud Vault</span>
                        </button>
                        <button id="btn-google-new" class="btn btn-secondary">
                            ‚ú® <span data-i18n="btnNewCloudVault">New Cloud Vault</span>
                        </button>
                    </div>
                    <!-- 2025-12-17: Reopen last cloud vault link -->
                    <a id="link-google-reopen" href="#" class="reopen-link cloud-reopen-link" style="display: none;">
                        <span data-i18n="btnReopenBase">Reopen</span> '<span id="google-reopen-filename"></span>'
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <main id="app-workspace" class="workspace" style="display: none;">
        <header class="header">
            <div class="header-vault">
                <span class="vault-label" data-i18n="vaultLabel">Vault:</span>
                <span id="file-badge" class="file-badge">üìÑ Loading...</span>
            </div>
            <h1 id="header-title" class="header-title">
                <img src="icons/logo.svg" alt="Zip80" class="header-logo header-logo-light">
                <img src="icons/logo-dark.svg" alt="Zip80" class="header-logo header-logo-dark">
            </h1>
            <div class="header-actions">
                <!-- 2025-12-17: Save Status Indicator - flashes on save, hidden otherwise -->
                <div id="save-status" class="save-status save-status-saved" title="All changes saved">
                    <span class="save-status-icon">‚úì</span>
                    <span class="save-status-text" data-i18n="statusSaved">Saved</span>
                </div>
                <button id="btn-close-vault" class="btn btn-secondary btn-save">
                    <span data-i18n="btnCloseVault">üö™ Close</span>
                </button>
            </div>
        </header>

        <!-- 2025-12-17: Menu Bar Framework - toolbar for view modes and options (below header) -->
        <nav id="menu-bar" class="menu-bar">
            <div class="menu-bar-left">
                <!-- View Mode Toggles -->
                <div class="view-mode-group">
                    <span class="view-mode-label" data-i18n="viewMode">View:</span>
                    <button id="btn-view-standard" class="menu-btn menu-btn-view active" data-view="standard"
                        title="Standard View">
                        üìã <span data-i18n="viewStandard">Standard</span>
                    </button>
                    <button id="btn-view-compact" class="menu-btn menu-btn-view" data-view="compact"
                        title="Compact View">
                        üìä <span data-i18n="viewCompact">Compact</span>
                    </button>
                </div>

                <!-- 2025-12-17: Undo/Redo Buttons (session-based history) -->
                <div class="undo-redo-group">
                    <button id="btn-undo" class="menu-btn menu-btn-icon disabled" disabled title="Undo">
                        ‚Ü∂
                    </button>
                    <button id="btn-redo" class="menu-btn menu-btn-icon disabled" disabled title="Redo">
                        ‚Ü∑
                    </button>
                </div>
            </div>
            <div class="menu-bar-right">
                <!-- Options Button -->
                <button id="btn-options" class="menu-btn menu-btn-options" aria-haspopup="true" aria-expanded="false">
                    ‚öôÔ∏è <span data-i18n="options">Options</span>
                </button>
                <!-- Options Dropdown Menu (hidden by default) -->
                <div id="options-dropdown" class="options-dropdown" style="display: none;">
                    <button class="dropdown-item" data-action="export-csv">
                        üìÑ <span data-i18n="exportCSV">Export as CSV</span>
                    </button>
                    <button class="dropdown-item" data-action="export-json">
                        üì• <span data-i18n="exportJSON">Export as JSON</span>
                    </button>
                    <!-- 2025-12-17: Change password (only for encrypted vaults) -->
                    <button id="btn-change-password" class="dropdown-item" data-action="change-password"
                        style="display: none;">
                        üîë <span data-i18n="changePassword">Change Password</span>
                    </button>
                    <div class="dropdown-divider"></div>
                    <button class="dropdown-item" data-action="settings">
                        üõ†Ô∏è <span data-i18n="settings">Settings</span>
                    </button>
                    <button class="dropdown-item" data-action="about">
                        ‚ÑπÔ∏è <span data-i18n="about">About</span>
                    </button>
                </div>
            </div>
        </nav>

        <!-- 2025-12-15: Added workspace layout with sidebar for balance overview -->
        <div class="workspace-layout">
            <!-- Main Content -->
            <div class="workspace-main">

                <!-- Account Selector -->
                <section class="card account-card">
                    <div class="account-header">
                        <h2 id="accounts-title" class="card-title">Accounts</h2>
                        <button id="btn-new-account" class="btn btn-secondary btn-sm">
                            <span data-i18n="newAccount">+ New Account</span>
                        </button>
                    </div>
                    <div id="account-tabs" class="account-tabs">
                        <!-- Account tabs rendered here -->
                    </div>
                </section>

                <!-- Balance Card (2025-12-15: Added credit card info section, combined with transaction form) -->
                <section class="card balance-card">
                    <div id="balance-label" class="balance-label">Current Balance</div>
                    <div class="balance-row">
                        <div id="balance-display" class="balance-value">$0.00</div>
                    </div>
                    <div id="account-currency" class="account-currency">USD</div>
                    <button id="btn-edit-balance" class="btn btn-secondary btn-sm"
                        style="margin-top: var(--space-sm); width: 100%;">
                        ‚úèÔ∏è <span data-i18n="adjustAmount">Adjust Amount</span>
                    </button>

                    <!-- Credit Card Info (shown for credit accounts) -->
                    <div id="credit-card-info" class="credit-card-info" style="display: none;">
                        <div class="credit-info-row">
                            <span id="credit-available-label">Available Credit:</span>
                            <span id="credit-available-value">$0.00</span>
                        </div>
                        <div class="credit-info-row">
                            <span id="credit-limit-label">Limit:</span>
                            <span id="credit-limit-value">$0.00</span>
                        </div>
                        <div class="credit-info-row">
                            <span id="credit-dates-label"></span>
                            <span id="credit-dates-value"></span>
                        </div>
                        <!-- 2025-12-15: Edit CC settings button -->
                        <button id="btn-edit-credit" class="btn btn-secondary btn-sm"
                            style="margin-top: var(--space-sm); width: 100%;">
                            ‚öôÔ∏è <span data-i18n="editCreditSettings">Edit Settings</span>
                        </button>
                    </div>

                    <!-- Account Settings (shown for checking/cash accounts) -->
                    <div id="account-settings-info" class="credit-card-info" style="display: none;">
                        <button id="btn-edit-account-settings" class="btn btn-secondary btn-sm" style="width: 100%;">
                            ‚öôÔ∏è <span data-i18n="editCreditSettings">Edit Settings</span>
                        </button>
                    </div>

                    <!-- 2025-12-16: Crypto account info (shows crypto balance below USD value) -->
                    <div id="crypto-account-info" class="crypto-account-info" style="display: none;">
                        <div class="crypto-balance-row">
                            <span id="crypto-balance-value">0.00000000 BTC</span>
                        </div>
                    </div>

                    <!-- 2025-12-15: Add Transaction Form (combined into balance card) -->
                    <div class="transaction-form-divider"></div>
                    <h3 id="add-transaction-title" class="transaction-form-title">Add Transaction</h3>

                    <!-- Transaction Mode Toggle -->
                    <div class="transaction-mode-row">
                        <button id="btn-mode-expense" class="btn btn-mode-toggle active" data-mode="expense">
                            <span data-i18n="modeExpense">‚ûñ Expense</span>
                        </button>
                        <button id="btn-mode-income" class="btn btn-mode-toggle" data-mode="income">
                            <span data-i18n="modeIncome">‚ûï Income</span>
                        </button>
                    </div>

                    <!-- Category Icons (shown only for expense mode) -->
                    <div id="category-icons" class="category-icons-row">
                        <button class="category-icon active" data-category="general" title="General">üí∏</button>
                        <button class="category-icon" data-category="food" title="Food">üçî</button>
                        <button class="category-icon" data-category="utilities" title="Utilities">üí°</button>
                        <button class="category-icon" data-category="transport" title="Transportation">üöó</button>
                        <button class="category-icon" data-category="housing" title="Housing">üè†</button>
                        <button class="category-icon" data-category="health" title="Health">üè•</button>
                        <button class="category-icon" data-category="fun" title="Entertainment">üéÆ</button>
                        <button class="category-icon" data-category="work" title="Work/Employee">üíº</button>
                    </div>

                    <!-- Recurring Toggle (shown only for expense mode) -->
                    <div id="recurring-toggle-row" class="recurring-toggle-row">
                        <label class="recurring-toggle-label">
                            <input type="checkbox" id="checkbox-recurring" class="recurring-checkbox">
                            <span data-i18n="recurringToggle">üîÅ Recurring?</span>
                        </label>
                    </div>

                    <!-- Recurring Frequency Row (shown when recurring is checked) -->
                    <div id="recurring-frequency-row" class="recurring-frequency-row" style="display: none;">
                        <span data-i18n="recurringEvery">Every</span>
                        <input type="number" id="input-recurring-months" class="input input-sm" value="1" min="1"
                            max="12">
                        <span data-i18n="recurringMonths">month(s)</span>
                    </div>

                    <div class="form-group">
                        <input type="text" id="input-desc" class="input"
                            placeholder="Description (e.g. Rent, Groceries)">
                    </div>
                    <div class="form-group">
                        <input type="text" inputmode="decimal" id="input-amount" class="input"
                            placeholder="Amount (0.00)" min="0">
                    </div>
                    <button id="btn-add-transaction" class="btn btn-danger btn-action btn-full">
                        <span data-i18n="btnAddTransaction">üí∏ Add Expense</span>
                    </button>
                </section>

                <!-- History Card -->
                <section class="card">
                    <div class="card-header">
                        <h2 id="history-title" class="card-title">History</h2>
                        <button id="btn-export" class="btn btn-secondary btn-sm">
                            <span data-i18n="btnExport">üì• Export JSON</span>
                        </button>
                    </div>
                    <ul id="history-list" class="history-list">
                        <!-- Transactions rendered here -->
                    </ul>
                    <p id="empty-state" class="empty-state">No transactions yet. Add one above!</p>
                </section>
            </div><!-- end workspace-main -->

            <!-- 2025-12-15: Balance Overview Sidebar Widget -->
            <!-- 2025-12-16: Updated with widget system for drag/drop and collapse -->
            <aside class="workspace-sidebar">
                <!-- Two-column layout for account widgets -->
                <div class="balance-widgets-row">
                    <!-- Bank/Cash Widget -->
                    <div class="card widget-card balance-widget-card" data-widget-id="balance-bank">
                        <div class="widget-header">
                            <h3 id="bank-widget-title" class="widget-title">üè¶ Bank/Cash</h3>
                        </div>
                        <div class="widget-content">
                            <div id="bank-accounts-list" class="widget-accounts-list">
                                <!-- Bank/Cash items rendered by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Credit Cards Widget -->
                    <div class="card widget-card balance-widget-card" data-widget-id="balance-credit">
                        <div class="widget-header">
                            <h3 id="credit-widget-title" class="widget-title">üí≥ Credit Cards</h3>
                        </div>
                        <div class="widget-content">
                            <div id="credit-accounts-list" class="widget-accounts-list">
                                <!-- Credit card items rendered by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- 2025-12-16: Crypto Widget -->
                    <div id="crypto-widget-card" class="card widget-card balance-widget-card"
                        data-widget-id="balance-crypto" style="display: none;">
                        <div class="widget-header">
                            <h3 id="crypto-widget-title" class="widget-title">ü™ô Crypto</h3>
                        </div>
                        <div class="widget-content">
                            <div id="crypto-accounts-list" class="widget-accounts-list">
                                <!-- Crypto items rendered by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2025-12-15: Calendar Widget -->
                <div class="card widget-card calendar-widget-card" data-widget-id="calendar">
                    <div class="widget-header">
                        <h3 id="calendar-widget-title" class="widget-title">üìÖ Calendar</h3>
                    </div>
                    <div class="widget-content">
                        <div id="calendar-full-date" class="calendar-full-date">
                            <!-- Full date rendered by JS -->
                        </div>
                        <div class="calendar-grid">
                            <div class="calendar-weekdays">
                                <span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span>
                            </div>
                            <div id="calendar-days" class="calendar-days">
                                <!-- Days rendered by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2025-12-16: Two-column layout for recurring and exchange widgets -->
                <div class="balance-widgets-row">
                    <!-- 2025-12-15: Recurring Expenses Widget -->
                    <div class="card widget-card recurring-widget-card" data-widget-id="recurring">
                        <div class="widget-header">
                            <h3 id="recurring-widget-title" class="widget-title">üîÅ Recurring Expenses</h3>
                        </div>
                        <div class="widget-content">
                            <div id="recurring-list" class="recurring-list">
                                <!-- Recurring items rendered by JS -->
                            </div>
                            <p id="recurring-empty" class="recurring-empty">No recurring expenses</p>
                            <!-- 2025-12-16: Total Monthly Expenses -->
                            <p id="recurring-total" class="recurring-total" style="display: none;"></p>
                        </div>
                    </div>

                    <!-- 2025-12-16: Exchange Rate Widget -->
                    <div class="card widget-card exchange-widget-card" data-widget-id="exchange">
                        <div class="widget-header">
                            <h3 id="exchange-widget-title" class="widget-title">üí± Exchange Rates</h3>
                        </div>
                        <div class="widget-content">
                            <div class="exchange-content">
                                <div id="exchange-rates" class="exchange-rates">
                                    <div class="exchange-rate-row">
                                        <span class="exchange-from">1 USD</span>
                                        <span class="exchange-arrow">=</span>
                                        <span id="rate-usd-mxn" class="exchange-to">--</span>
                                        <span class="exchange-currency">MXN</span>
                                    </div>
                                    <div class="exchange-rate-row">
                                        <span class="exchange-from">1 MXN</span>
                                        <span class="exchange-arrow">=</span>
                                        <span id="rate-mxn-usd" class="exchange-to">--</span>
                                        <span class="exchange-currency">USD</span>
                                    </div>
                                </div>
                                <div class="exchange-chart">
                                    <!-- 2025-12-16: Enhanced chart with X-axis labels and hover tooltip -->
                                    <div class="exchange-chart-container">
                                        <svg id="exchange-sparkline" viewBox="0 0 120 55" preserveAspectRatio="none">
                                            <!-- Chart line -->
                                            <polyline id="sparkline-path" fill="none" stroke="#22c55e"
                                                stroke-width="1.5" points="">
                                            </polyline>
                                            <!-- Hover circles (added dynamically) -->
                                            <g id="sparkline-dots"></g>
                                        </svg>
                                        <!-- X-axis labels -->
                                        <div id="chart-x-axis" class="chart-x-axis"></div>
                                        <!-- Hover tooltip -->
                                        <div id="chart-tooltip" class="chart-tooltip" style="display: none;">
                                            <span class="tooltip-rate"></span>
                                            <span class="tooltip-date"></span>
                                        </div>
                                    </div>
                                    <!-- Percentage change indicator -->
                                    <div class="chart-change-row">
                                        <span id="chart-change" class="chart-change">--</span>
                                        <div class="chart-range-btns">
                                            <button class="chart-range-btn active" data-days="7">7d</button>
                                            <button class="chart-range-btn" data-days="30">1m</button>
                                            <button class="chart-range-btn" data-days="180">6m</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p id="exchange-updated" class="exchange-updated">Loading...</p>
                        </div>
                    </div>

                    <!-- 2025-12-17: Activity Log Widget for shared vault attribution -->
                    <div class="card widget-card" data-widget-id="activity-log">
                        <div class="widget-header">
                            <h3 id="activity-log-title" class="widget-title">üìã Activity Log</h3>
                        </div>
                        <div class="widget-content">
                            <div id="activity-log-list" class="activity-log-list">
                                <!-- Activity items rendered by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </div><!-- end workspace-layout -->
    </main>

    <!-- New Account Modal (2025-12-15: Added credit card fields) -->
    <div id="account-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-content-lg">
            <h2 id="modal-title" class="modal-title">New Account</h2>

            <!-- Account Type Selector -->
            <div class="form-group">
                <label id="label-account-type">Account Type</label>
                <!-- 2025-12-17: Replaced select with icon buttons -->
                <input type="hidden" id="select-account-type" value="checking">
                <div id="account-type-grid" class="account-type-grid">
                    <!-- Buttons injected by JS -->
                </div>
            </div>

            <!-- Account Name -->
            <div class="form-group">
                <label id="label-account-name" for="input-account-name">Account Name</label>
                <input type="text" id="input-account-name" class="input" placeholder="e.g. Checking, Savings">
            </div>

            <!-- Currency -->
            <div class="form-group">
                <label id="label-currency" for="select-currency">Currency</label>
                <select id="select-currency" class="input">
                    <option value="USD">USD - US Dollar ($)</option>
                    <option value="MXN">MXN - Mexican Peso ($MXN)</option>
                </select>
            </div>

            <!-- Credit Card Fields (shown when type = credit) -->
            <div id="credit-card-fields" class="credit-card-fields" style="display: none;">
                <div class="form-group">
                    <label id="label-credit-limit" for="input-credit-limit">Credit Limit</label>
                    <input type="text" inputmode="decimal" id="input-credit-limit" class="input" placeholder="e.g. 5000"
                        min="0">
                </div>
                <div class="form-row">
                    <div class="form-group form-group-half">
                        <label id="label-payment-due-day" for="select-payment-due-day">Payment Due Day</label>
                        <select id="select-payment-due-day" class="input">
                            <!-- Days 1-31 populated by JS -->
                        </select>
                    </div>
                    <div class="form-group form-group-half">
                        <label id="label-statement-close-day" for="select-statement-close-day">Statement Close
                            Day</label>
                        <select id="select-statement-close-day" class="input">
                            <!-- Days 1-31 populated by JS -->
                        </select>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button id="btn-cancel-account" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
                <button id="btn-create-account" class="btn btn-primary">
                    <span data-i18n="createAccount">Create Account</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Balance Modal -->
    <div id="balance-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="balance-modal-title" class="modal-title">Edit Balance</h2>
            <p id="balance-modal-desc" class="modal-desc">Set the new balance. An adjustment transaction will be
                created.</p>
            <div class="form-group">
                <label id="label-new-balance" for="input-new-balance">New Balance</label>
                <input type="text" inputmode="decimal" id="input-new-balance" class="input" placeholder="0.00">
            </div>
            <div class="form-group">
                <label id="label-adjustment-reason" for="input-adjustment-reason">Reason for Adjustment</label>
                <input type="text" id="input-adjustment-reason" class="input"
                    placeholder="e.g. Bank reconciliation, Error correction">
            </div>
            <div class="modal-actions">
                <button id="btn-cancel-balance" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
                <button id="btn-apply-balance" class="btn btn-primary">
                    <span data-i18n="applyBalance">Apply</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 2025-12-15: Edit Credit Card Modal -->
    <div id="credit-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="credit-modal-title" class="modal-title">‚öôÔ∏è Credit Card Settings</h2>
            <p id="credit-modal-desc" class="modal-desc">Edit your credit card account settings.</p>

            <div class="form-group">
                <label id="label-edit-credit-limit" for="input-edit-credit-limit">Credit Limit</label>
                <input type="text" inputmode="decimal" id="input-edit-credit-limit" class="input"
                    placeholder="e.g. 5000" min="0">
            </div>

            <div class="form-row">
                <div class="form-group form-group-half">
                    <label id="label-edit-payment-due" for="select-edit-payment-due">Payment Due Day</label>
                    <select id="select-edit-payment-due" class="input"></select>
                </div>
                <div class="form-group form-group-half">
                    <label id="label-edit-statement-close" for="select-edit-statement-close">Statement Close Day</label>
                    <select id="select-edit-statement-close" class="input"></select>
                </div>
            </div>

            <div class="modal-actions">
                <button id="btn-cancel-credit" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
                <button id="btn-save-credit" class="btn btn-primary">
                    <span data-i18n="saveChanges">Save Changes</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 2025-12-15: Edit Account Modal (for checking/cash accounts) -->
    <div id="account-edit-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="account-edit-modal-title" class="modal-title">‚öôÔ∏è Account Settings</h2>
            <p id="account-edit-modal-desc" class="modal-desc">Edit your account settings.</p>

            <div class="form-group">
                <label id="label-edit-account-name" for="input-edit-account-name">Account Name</label>
                <input type="text" id="input-edit-account-name" class="input" placeholder="Account Name">
            </div>

            <div class="form-group">
                <label id="label-edit-account-currency" for="select-edit-account-currency">Currency</label>
                <select id="select-edit-account-currency" class="input">
                    <option value="USD">USD - US Dollar ($)</option>
                    <option value="MXN">MXN - Mexican Peso ($MXN)</option>
                </select>
            </div>

            <div class="modal-actions">
                <button id="btn-cancel-account-edit" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
                <button id="btn-save-account-edit" class="btn btn-primary">
                    <span data-i18n="saveChanges">Save Changes</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 2025-12-15: New Vault Modal - Settings for new data files -->
    <!-- 2025-12-17: Added encryption option with password fields -->
    <div id="vault-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="vault-modal-title" class="modal-title">‚ú® Create New Vault</h2>
            <p id="vault-modal-desc" class="modal-desc">Set your preferences for this expense tracker.</p>

            <!-- Default Language -->
            <div class="form-group">
                <label id="label-vault-language" for="select-vault-language">Default Language</label>
                <select id="select-vault-language" class="input">
                    <option value="en">üá∫üá∏ English</option>
                    <option value="es">üá≤üáΩ Espa√±ol</option>
                </select>
            </div>

            <!-- Default Currency -->
            <div class="form-group">
                <label id="label-vault-currency" for="select-vault-currency">Default Currency</label>
                <select id="select-vault-currency" class="input">
                    <option value="USD">USD - US Dollar ($)</option>
                    <option value="MXN">MXN - Mexican Peso ($MXN)</option>
                </select>
            </div>

            <!-- Vault Name (used as suggested filename) -->
            <div class="form-group">
                <label id="label-vault-name" for="input-vault-name">Vault Name</label>
                <input type="text" id="input-vault-name" class="input" placeholder="e.g. Personal, Business, Savings">
            </div>

            <!-- 2025-12-17: Encryption Toggle -->
            <div class="form-group encryption-toggle-group">
                <label class="encryption-toggle-label">
                    <input type="checkbox" id="checkbox-encrypt-vault" class="encryption-checkbox">
                    <span id="label-encrypt-vault" data-i18n="encryptVault">üîí Encrypt this vault</span>
                </label>
            </div>

            <!-- Encryption Password Fields (shown when encrypt checkbox is checked) -->
            <div id="encryption-fields" class="encryption-fields" style="display: none;">
                <p id="encryption-warning" class="encryption-warning" data-i18n="encryptionWarning">
                    ‚ö†Ô∏è If you forget your password, your data cannot be recovered.
                </p>
                <div class="form-group">
                    <label id="label-vault-password" for="input-vault-password"
                        data-i18n="passwordLabel">Password</label>
                    <input type="password" id="input-vault-password" class="input" placeholder="Enter password">
                </div>
                <div class="form-group">
                    <label id="label-vault-confirm-password" for="input-vault-confirm-password"
                        data-i18n="confirmPasswordLabel">Confirm Password</label>
                    <input type="password" id="input-vault-confirm-password" class="input"
                        placeholder="Confirm password">
                </div>
                <div class="form-group">
                    <label id="label-vault-hint" for="input-vault-hint" data-i18n="hintLabel">Password Hint
                        (required)</label>
                    <input type="text" id="input-vault-hint" class="input" placeholder="e.g. My favorite movie">
                </div>
            </div>

            <div class="modal-actions">
                <button id="btn-cancel-vault" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
                <button id="btn-create-vault" class="btn btn-primary">
                    <span data-i18n="createVault">Create Vault</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 2025-12-17: Password Modal (for opening encrypted vaults) -->
    <div id="password-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="password-modal-title" class="modal-title">üîê Encrypted Vault</h2>
            <p id="password-modal-desc" class="modal-desc">This vault is encrypted. Enter your password to unlock it.
            </p>

            <div class="form-group">
                <label id="label-unlock-password" for="input-unlock-password" data-i18n="passwordLabel">Password</label>
                <input type="password" id="input-unlock-password" class="input" placeholder="Enter password">
            </div>

            <!-- 2025-12-17: Password hint display (shown after 2 failed attempts) -->
            <div id="password-hint-display" class="password-hint-display" style="display: none;">
                <span id="hint-label" data-i18n="hintLabel">Hint:</span>
                <span id="hint-text"></span>
            </div>

            <div class="modal-actions">
                <button id="btn-cancel-unlock" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
                <button id="btn-unlock-vault" class="btn btn-primary">
                    <span data-i18n="unlockVault">üîì Unlock</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 2025-12-17: Change Password Modal (for encrypted vaults) -->
    <div id="change-password-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="change-password-modal-title" class="modal-title">üîë Change Password</h2>
            <p id="change-password-modal-desc" class="modal-desc">Enter your current password and choose a new one.</p>

            <div class="form-group">
                <label id="label-current-password" for="input-current-password" data-i18n="currentPasswordLabel">Current
                    Password</label>
                <input type="password" id="input-current-password" class="input" placeholder="Enter current password">
            </div>
            <div class="form-group">
                <label id="label-new-password" for="input-new-password" data-i18n="newPasswordLabel">New
                    Password</label>
                <input type="password" id="input-new-password" class="input" placeholder="Enter new password">
            </div>
            <div class="form-group">
                <label id="label-confirm-new-password" for="input-confirm-new-password"
                    data-i18n="confirmNewPasswordLabel">Confirm New Password</label>
                <input type="password" id="input-confirm-new-password" class="input" placeholder="Confirm new password">
            </div>
            <div class="form-group">
                <label id="label-new-hint" for="input-new-hint" data-i18n="newHintLabel">New Password Hint</label>
                <input type="text" id="input-new-hint" class="input" placeholder="e.g. My favorite movie">
            </div>

            <div class="modal-actions">
                <button id="btn-cancel-change-password" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
                <button id="btn-confirm-change-password" class="btn btn-primary">
                    <span data-i18n="changePassword">üîë Change Password</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 2025-12-15: Custom Confirm Modal (replaces native confirm dialog) -->
    <div id="confirm-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="confirm-modal-title" class="modal-title">‚ö†Ô∏è Confirm</h2>
            <p id="confirm-modal-message" class="modal-desc">Are you sure?</p>
            <div class="modal-actions">
                <button id="btn-confirm-cancel" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
                <button id="btn-confirm-ok" class="btn btn-danger">
                    <span data-i18n="confirm">Confirm</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast" aria-live="polite"></div>

    <!-- 2025-12-16: Google Drive Vault Picker Modal -->
    <div id="gdrive-picker-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="gdrive-picker-title" class="modal-title">‚òÅÔ∏è Your Cloud Vaults</h2>
            <div id="gdrive-vault-list" class="gdrive-vault-list">
                <!-- Vault items rendered by JS -->
            </div>
            <div class="modal-actions">
                <button id="btn-gdrive-cancel" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
            </div>
        </div>
    </div>

    <script src="js/i18n.js"></script>
    <script src="js/accounts.js"></script>
    <!-- 2025-12-17: Crypto module for vault encryption (must load before storage.js) -->
    <script src="js/crypto.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/gdrive.js"></script>
    <script src="js/calendar.js"></script>
    <!-- 2025-12-16: Widget system with SortableJS for drag-and-drop -->
    <script src="js/Sortable.min.js"></script>
    <script src="js/widgets.js"></script>
    <!-- 2025-12-17: Menu bar controller for view modes and options -->
    <!-- 2025-12-17: History module for undo/redo -->
    <script src="js/history.js"></script>
    <script src="js/menubar.js"></script>
    <script src="js/app.js"></script>

    <!-- 2025-12-17: Title bar window controls -->
    <script>
        // Wire up custom title bar buttons (only in Electron)
        if (window.electronAPI && window.electronAPI.isElectron) {
            document.getElementById('btn-minimize')?.addEventListener('click', () => {
                window.electronAPI.minimizeWindow();
            });
            document.getElementById('btn-maximize')?.addEventListener('click', () => {
                window.electronAPI.maximizeWindow();
            });
            document.getElementById('btn-close')?.addEventListener('click', () => {
                window.electronAPI.closeWindow();
            });
        } else {
            // Hide title bar in browser (not Electron)
            const titleBar = document.getElementById('title-bar');
            if (titleBar) titleBar.style.display = 'none';
            document.body.style.paddingTop = '0';
        }
    </script>
</body>

</html>