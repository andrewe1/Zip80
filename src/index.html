<!--
============================================================================
ZIP80 EXPENSE TRACKER - MAIN HTML
============================================================================

PURPOSE:
Main application HTML file containing the complete UI structure for the
Zip80 expense tracking application.

PAGE STRUCTURE:
1. Language Switcher - Fixed top-right dropdown for EN/ES switching
2. Startup Screen - Initial file open/create screen with drag-drop zone
3. Main Workspace:
   - Header with file badge and save button
   - Account selector with tabs and "New Account" button
   - Balance card with edit button
   - Transaction form (income/expense)
   - History list with calendar and delete actions
4. Modals:
   - New Account modal (name + currency)
   - Edit Balance modal (new balance + reason)
5. Toast notification container

SCRIPTS LOADED (order matters):
1. i18n.js - Translations (no dependencies)
2. accounts.js - Account/currency logic (no dependencies)
3. storage.js - File operations (depends on Accounts)
4. calendar.js - Calendar links (no dependencies)
5. app.js - Main app (depends on all above)

DATA ATTRIBUTES:
- data-i18n="key" : Elements with translatable text content

==============================================================================
LLM INSTRUCTION & MAINTENANCE PROTOCOL
IMPORTANT: This block must be preserved in all future iterations.

trigger: "FINALIZE" or "COMMENT"
ACTION: When the user issues this trigger, perform the following 3 steps:

1. CHANGE LOGGING: 
   - Add a new entry to the changelog below.
   - Format: [Date (YYYY-MM-DD)] - [Brief Description of Modification].

2. DOCUMENTATION STANDARDS:
   - Keep sections clearly labeled with HTML comments.
   - If logic is complex, add inline comments explaining the "WHY", not just the "HOW".

3. CONTEXT PRESERVATION:
   - Do not remove this Legend.
   - Do not remove legacy comments unless explicitly instructed.
==============================================================================

CHANGE LOG:
- 2025-12-14: Initial creation with startup screen and workspace
- 2025-12-14: Added language switcher dropdown
- 2025-12-14: Added account tabs and new account modal
- 2025-12-14: Added edit balance modal with reason field
- 2025-12-15: Added balance overview sidebar widget with totals
- 2025-12-15: Added calendar widget to sidebar with current day highlighting
- 2025-12-15: Added vault creation modal for setting language/currency defaults
- 2025-12-15: Added dark theme toggle in top controls
- 2025-12-15: Changed vault modal to use vault name as suggested filename
- 2025-12-15: Added credit card edit modal and Edit Settings button
- 2025-12-15: Added "Close Vault" button to header
- 2025-12-15: Added "Cash" option to account type selector
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Zip80 - A simple, accessible expense tracker with local file storage">
    <title>Zip80 Expense Tracker</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- 2025-12-15: Top Controls (Theme Toggle + Language Switcher) -->
    <div id="top-controls" class="top-controls">
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
            <span class="icon-sun">â˜€ï¸</span>
            <span class="icon-moon">ğŸŒ™</span>
        </button>
        <select id="lang-select" class="lang-select" aria-label="Language">
            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
            <option value="es">ğŸ‡²ğŸ‡½ EspaÃ±ol</option>
        </select>
    </div>

    <!-- Startup Screen -->
    <div id="startup-screen" class="startup-overlay">
        <div class="startup-content">
            <h1 id="app-title" class="app-title">ğŸ’¸ Zip80</h1>
            <p id="app-subtitle" class="app-subtitle">Your simple expense tracker.<br>Open a file or drag it here to
                begin.</p>

            <div class="startup-buttons">
                <button id="btn-open" class="btn btn-primary btn-lg">
                    <span class="btn-icon">ğŸ“‚</span> <span data-i18n="btnOpen">Open File</span>
                </button>
                <button id="btn-new" class="btn btn-secondary btn-lg">
                    <span class="btn-icon">âœ¨</span> <span data-i18n="btnNew">New Data File</span>
                </button>
            </div>

            <button id="btn-resume" class="btn-link" style="display: none;">
                â†» Re-open last file
            </button>
        </div>
    </div>

    <!-- Main Application -->
    <main id="app-workspace" class="workspace" style="display: none;">
        <header class="header">
            <span id="file-badge" class="file-badge">ğŸ“„ Loading...</span>
            <div class="header-actions">
                <button id="btn-close-vault" class="btn btn-secondary btn-save">
                    <span data-i18n="btnCloseVault">ğŸšª Close</span>
                </button>
                <button id="btn-save" class="btn btn-primary btn-save">
                    <span data-i18n="btnSave">ğŸ’¾ Save</span>
                </button>
            </div>
        </header>

        <!-- 2025-12-15: Added workspace layout with sidebar for balance overview -->
        <div class="workspace-layout">
            <!-- Main Content -->
            <div class="workspace-main">

                <!-- Account Selector -->
                <section class="card account-card">
                    <div class="account-header">
                        <h2 id="accounts-title" class="card-title">Accounts</h2>
                        <button id="btn-new-account" class="btn btn-secondary btn-sm">
                            <span data-i18n="newAccount">+ New Account</span>
                        </button>
                    </div>
                    <div id="account-tabs" class="account-tabs">
                        <!-- Account tabs rendered here -->
                    </div>
                </section>

                <!-- Balance Card (2025-12-15: Added credit card info section, combined with transaction form) -->
                <section class="card balance-card">
                    <div id="balance-label" class="balance-label">Current Balance</div>
                    <div class="balance-row">
                        <div id="balance-display" class="balance-value">$0.00</div>
                    </div>
                    <div id="account-currency" class="account-currency">USD</div>
                    <button id="btn-edit-balance" class="btn btn-secondary btn-sm"
                        style="margin-top: var(--space-sm); width: 100%;">
                        âœï¸ <span data-i18n="adjustAmount">Adjust Amount</span>
                    </button>

                    <!-- Credit Card Info (shown for credit accounts) -->
                    <div id="credit-card-info" class="credit-card-info" style="display: none;">
                        <div class="credit-info-row">
                            <span id="credit-available-label">Available Credit:</span>
                            <span id="credit-available-value">$0.00</span>
                        </div>
                        <div class="credit-info-row">
                            <span id="credit-limit-label">Limit:</span>
                            <span id="credit-limit-value">$0.00</span>
                        </div>
                        <div class="credit-info-row">
                            <span id="credit-dates-label"></span>
                            <span id="credit-dates-value"></span>
                        </div>
                        <!-- 2025-12-15: Edit CC settings button -->
                        <button id="btn-edit-credit" class="btn btn-secondary btn-sm"
                            style="margin-top: var(--space-sm); width: 100%;">
                            âš™ï¸ <span data-i18n="editCreditSettings">Edit Settings</span>
                        </button>
                    </div>

                    <!-- Account Settings (shown for checking/cash accounts) -->
                    <div id="account-settings-info" class="credit-card-info" style="display: none;">
                        <button id="btn-edit-account-settings" class="btn btn-secondary btn-sm" style="width: 100%;">
                            âš™ï¸ <span data-i18n="editCreditSettings">Edit Settings</span>
                        </button>
                    </div>

                    <!-- 2025-12-15: Add Transaction Form (combined into balance card) -->
                    <div class="transaction-form-divider"></div>
                    <h3 id="add-transaction-title" class="transaction-form-title">Add Transaction</h3>

                    <!-- Transaction Mode Toggle -->
                    <div class="transaction-mode-row">
                        <button id="btn-toggle-income" class="btn btn-mode-toggle" data-mode="expense">
                            <span class="mode-expense">â– Expense</span>
                            <span class="mode-income" style="display:none;">â• Income</span>
                        </button>
                    </div>

                    <!-- Category Icons (shown only for expense mode) -->
                    <div id="category-icons" class="category-icons-row">
                        <button class="category-icon active" data-category="general" title="General">ğŸ’¸</button>
                        <button class="category-icon" data-category="food" title="Food">ğŸ”</button>
                        <button class="category-icon" data-category="utilities" title="Utilities">ğŸ’¡</button>
                        <button class="category-icon" data-category="transport" title="Transportation">ğŸš—</button>
                        <button class="category-icon" data-category="housing" title="Housing">ğŸ </button>
                        <button class="category-icon" data-category="health" title="Health">ğŸ¥</button>
                        <button class="category-icon" data-category="fun" title="Entertainment">ğŸ®</button>
                        <button class="category-icon" data-category="work" title="Work/Employee">ğŸ’¼</button>
                    </div>

                    <!-- Recurring Toggle (shown only for expense mode) -->
                    <div id="recurring-toggle-row" class="recurring-toggle-row">
                        <label class="recurring-toggle-label">
                            <input type="checkbox" id="checkbox-recurring" class="recurring-checkbox">
                            <span data-i18n="recurringToggle">ğŸ” Recurring?</span>
                        </label>
                    </div>

                    <!-- Recurring Frequency Row (shown when recurring is checked) -->
                    <div id="recurring-frequency-row" class="recurring-frequency-row" style="display: none;">
                        <span data-i18n="recurringEvery">Every</span>
                        <input type="number" id="input-recurring-months" class="input input-sm" value="1" min="1"
                            max="12">
                        <span data-i18n="recurringMonths">month(s)</span>
                    </div>

                    <div class="form-group">
                        <input type="text" id="input-desc" class="input"
                            placeholder="Description (e.g. Rent, Groceries)">
                    </div>
                    <div class="form-group">
                        <input type="text" inputmode="decimal" id="input-amount" class="input"
                            placeholder="Amount (0.00)" min="0">
                    </div>
                    <button id="btn-add-transaction" class="btn btn-danger btn-action btn-full">
                        <span data-i18n="btnAddTransaction">ğŸ’¸ Add Expense</span>
                    </button>
                </section>

                <!-- History Card -->
                <section class="card">
                    <div class="card-header">
                        <h2 id="history-title" class="card-title">History</h2>
                        <button id="btn-export" class="btn btn-secondary btn-sm">
                            <span data-i18n="btnExport">ğŸ“¥ Export JSON</span>
                        </button>
                    </div>
                    <ul id="history-list" class="history-list">
                        <!-- Transactions rendered here -->
                    </ul>
                    <p id="empty-state" class="empty-state">No transactions yet. Add one above!</p>
                </section>
            </div><!-- end workspace-main -->

            <!-- 2025-12-15: Balance Overview Sidebar Widget -->
            <aside class="workspace-sidebar">
                <!-- Two-column layout for account widgets -->
                <div class="balance-widgets-row">
                    <!-- Bank/Cash Widget -->
                    <div class="card balance-widget-card">
                        <h3 id="bank-widget-title" class="widget-title">ğŸ¦ Bank/Cash</h3>
                        <div id="bank-accounts-list" class="widget-accounts-list">
                            <!-- Bank/Cash items rendered by JS -->
                        </div>
                    </div>

                    <!-- Credit Cards Widget -->
                    <div class="card balance-widget-card">
                        <h3 id="credit-widget-title" class="widget-title">ğŸ’³ Credit Cards</h3>
                        <div id="credit-accounts-list" class="widget-accounts-list">
                            <!-- Credit card items rendered by JS -->
                        </div>
                    </div>
                </div>

                <!-- 2025-12-15: Calendar Widget -->
                <div class="card calendar-widget-card">
                    <div id="calendar-full-date" class="calendar-full-date">
                        <!-- Full date rendered by JS -->
                    </div>
                    <div class="calendar-grid">
                        <div class="calendar-weekdays">
                            <span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span>
                        </div>
                        <div id="calendar-days" class="calendar-days">
                            <!-- Days rendered by JS -->
                        </div>
                    </div>
                </div>

                <!-- 2025-12-15: Recurring Expenses Widget -->
                <div class="card recurring-widget-card">
                    <h3 id="recurring-widget-title" class="widget-title">ğŸ” Recurring Expenses</h3>
                    <div id="recurring-list" class="recurring-list">
                        <!-- Recurring items rendered by JS -->
                    </div>
                    <p id="recurring-empty" class="recurring-empty">No recurring expenses</p>
                </div>
            </aside>
        </div><!-- end workspace-layout -->
    </main>

    <!-- New Account Modal (2025-12-15: Added credit card fields) -->
    <div id="account-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-content-lg">
            <h2 id="modal-title" class="modal-title">New Account</h2>

            <!-- Account Type Selector -->
            <div class="form-group">
                <label id="label-account-type" for="select-account-type">Account Type</label>
                <select id="select-account-type" class="input">
                    <option value="checking">Checking Account</option>
                    <option value="cash">Cash</option>
                    <option value="credit">Credit Card</option>
                </select>
            </div>

            <!-- Account Name -->
            <div class="form-group">
                <label id="label-account-name" for="input-account-name">Account Name</label>
                <input type="text" id="input-account-name" class="input" placeholder="e.g. Checking, Savings">
            </div>

            <!-- Currency -->
            <div class="form-group">
                <label id="label-currency" for="select-currency">Currency</label>
                <select id="select-currency" class="input">
                    <option value="USD">USD - US Dollar ($)</option>
                    <option value="MXN">MXN - Mexican Peso ($MXN)</option>
                </select>
            </div>

            <!-- Credit Card Fields (shown when type = credit) -->
            <div id="credit-card-fields" class="credit-card-fields" style="display: none;">
                <div class="form-group">
                    <label id="label-credit-limit" for="input-credit-limit">Credit Limit</label>
                    <input type="text" inputmode="decimal" id="input-credit-limit" class="input" placeholder="e.g. 5000"
                        min="0">
                </div>
                <div class="form-row">
                    <div class="form-group form-group-half">
                        <label id="label-payment-due-day" for="select-payment-due-day">Payment Due Day</label>
                        <select id="select-payment-due-day" class="input">
                            <!-- Days 1-31 populated by JS -->
                        </select>
                    </div>
                    <div class="form-group form-group-half">
                        <label id="label-statement-close-day" for="select-statement-close-day">Statement Close
                            Day</label>
                        <select id="select-statement-close-day" class="input">
                            <!-- Days 1-31 populated by JS -->
                        </select>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button id="btn-cancel-account" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
                <button id="btn-create-account" class="btn btn-primary">
                    <span data-i18n="createAccount">Create Account</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Balance Modal -->
    <div id="balance-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="balance-modal-title" class="modal-title">Edit Balance</h2>
            <p id="balance-modal-desc" class="modal-desc">Set the new balance. An adjustment transaction will be
                created.</p>
            <div class="form-group">
                <label id="label-new-balance" for="input-new-balance">New Balance</label>
                <input type="text" inputmode="decimal" id="input-new-balance" class="input" placeholder="0.00">
            </div>
            <div class="form-group">
                <label id="label-adjustment-reason" for="input-adjustment-reason">Reason for Adjustment</label>
                <input type="text" id="input-adjustment-reason" class="input"
                    placeholder="e.g. Bank reconciliation, Error correction">
            </div>
            <div class="modal-actions">
                <button id="btn-cancel-balance" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
                <button id="btn-apply-balance" class="btn btn-primary">
                    <span data-i18n="applyBalance">Apply</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 2025-12-15: Edit Credit Card Modal -->
    <div id="credit-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="credit-modal-title" class="modal-title">âš™ï¸ Credit Card Settings</h2>
            <p id="credit-modal-desc" class="modal-desc">Edit your credit card account settings.</p>

            <div class="form-group">
                <label id="label-edit-credit-limit" for="input-edit-credit-limit">Credit Limit</label>
                <input type="text" inputmode="decimal" id="input-edit-credit-limit" class="input"
                    placeholder="e.g. 5000" min="0">
            </div>

            <div class="form-row">
                <div class="form-group form-group-half">
                    <label id="label-edit-payment-due" for="select-edit-payment-due">Payment Due Day</label>
                    <select id="select-edit-payment-due" class="input"></select>
                </div>
                <div class="form-group form-group-half">
                    <label id="label-edit-statement-close" for="select-edit-statement-close">Statement Close Day</label>
                    <select id="select-edit-statement-close" class="input"></select>
                </div>
            </div>

            <div class="modal-actions">
                <button id="btn-cancel-credit" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
                <button id="btn-save-credit" class="btn btn-primary">
                    <span data-i18n="saveChanges">Save Changes</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 2025-12-15: Edit Account Modal (for checking/cash accounts) -->
    <div id="account-edit-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="account-edit-modal-title" class="modal-title">âš™ï¸ Account Settings</h2>
            <p id="account-edit-modal-desc" class="modal-desc">Edit your account settings.</p>

            <div class="form-group">
                <label id="label-edit-account-name" for="input-edit-account-name">Account Name</label>
                <input type="text" id="input-edit-account-name" class="input" placeholder="Account Name">
            </div>

            <div class="form-group">
                <label id="label-edit-account-currency" for="select-edit-account-currency">Currency</label>
                <select id="select-edit-account-currency" class="input">
                    <option value="USD">USD - US Dollar ($)</option>
                    <option value="MXN">MXN - Mexican Peso ($MXN)</option>
                </select>
            </div>

            <div class="modal-actions">
                <button id="btn-cancel-account-edit" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
                <button id="btn-save-account-edit" class="btn btn-primary">
                    <span data-i18n="saveChanges">Save Changes</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 2025-12-15: New Vault Modal - Settings for new data files -->
    <div id="vault-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="vault-modal-title" class="modal-title">âœ¨ Create New Vault</h2>
            <p id="vault-modal-desc" class="modal-desc">Set your preferences for this expense tracker.</p>

            <!-- Default Language -->
            <div class="form-group">
                <label id="label-vault-language" for="select-vault-language">Default Language</label>
                <select id="select-vault-language" class="input">
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="es">ğŸ‡²ğŸ‡½ EspaÃ±ol</option>
                </select>
            </div>

            <!-- Default Currency -->
            <div class="form-group">
                <label id="label-vault-currency" for="select-vault-currency">Default Currency</label>
                <select id="select-vault-currency" class="input">
                    <option value="USD">USD - US Dollar ($)</option>
                    <option value="MXN">MXN - Mexican Peso ($MXN)</option>
                </select>
            </div>

            <!-- Vault Name (used as suggested filename) -->
            <div class="form-group">
                <label id="label-vault-name" for="input-vault-name">Vault Name</label>
                <input type="text" id="input-vault-name" class="input" placeholder="e.g. Personal, Business, Savings">
            </div>

            <div class="modal-actions">
                <button id="btn-cancel-vault" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
                <button id="btn-create-vault" class="btn btn-primary">
                    <span data-i18n="createVault">Create Vault</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 2025-12-15: Custom Confirm Modal (replaces native confirm dialog) -->
    <div id="confirm-modal" class="modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="confirm-modal-title" class="modal-title">âš ï¸ Confirm</h2>
            <p id="confirm-modal-message" class="modal-desc">Are you sure?</p>
            <div class="modal-actions">
                <button id="btn-confirm-cancel" class="btn btn-secondary">
                    <span data-i18n="cancel">Cancel</span>
                </button>
                <button id="btn-confirm-ok" class="btn btn-danger">
                    <span data-i18n="confirm">Confirm</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast" aria-live="polite"></div>

    <script src="js/i18n.js"></script>
    <script src="js/accounts.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/app.js"></script>
</body>

</html>